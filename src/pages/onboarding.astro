---
import { OnboardingView } from "../components/views/OnboardingView";
import Layout from "../layouts/Layout.astro";

/**
 * Strona onboardingu - zbieranie 3 pierwszych treningów.
 *
 * OCHRONA:
 * - Middleware przekierowuje niezalogowanych na /login (pierwsza linia obrony)
 * - Page-level guard poniżej (druga linia obrony - defense in depth)
 *
 * UWAGA: Astro.locals.user jest ustawiane przez middleware (src/middleware/index.ts)
 */

// Auth guard - weryfikacja że user jest zalogowany
const { user } = Astro.locals;

if (!user) {
  return Astro.redirect("/login");
}

// Get the 'next' parameter from URL for redirect after completion
const nextUrl = Astro.url.searchParams.get("next") || "/";
---

<Layout title="Rozpocznij treningi">
  <OnboardingView client:load nextUrl={nextUrl} />
</Layout>
